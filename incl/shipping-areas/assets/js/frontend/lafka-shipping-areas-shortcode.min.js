"use strict";function lafka_handle_areas_shortcode(){const r=new google.maps.Map(document.getElementById(lafka_shipping_areas_shortcode_php_variables.shortcode_id+"_map"),{center:new google.maps.LatLng("0","0"),zoom:2});let a=[];try{a=JSON.parse(lafka_shipping_areas_shortcode_php_variables.areas)}catch(a){return!1}const t=new google.maps.LatLngBounds;a.forEach(a=>{const e=google.maps.geometry.encoding.decodePath(a.polygon_coordinates),o=(e.forEach(a=>{t.extend(a)}),new google.maps.Polygon({path:e,editable:!1,strokeColor:a.color,strokeOpacity:.8,strokeWeight:3,fillColor:a.color,fillOpacity:.35}));o.setMap(r),lafka_add_area_label(lafka_get_polygon_label_coordinates(e,a.label_position),r,a.label)}),"yes"===lafka_shipping_areas_shortcode_php_variables.circle_area&&lafka_handle_radius_for_shortcode(r,lafka_shipping_areas_shortcode_php_variables.set_store_location,lafka_shipping_areas_shortcode_php_variables.store_location,lafka_shipping_areas_shortcode_php_variables.store_map_location,lafka_shipping_areas_shortcode_php_variables.circle_radius,lafka_shipping_areas_shortcode_php_variables.circle_radius_unit,lafka_shipping_areas_shortcode_php_variables.circle_label_text,lafka_shipping_areas_shortcode_php_variables.circle_area_color).then(a=>t.union(a.getBounds())),t.isEmpty()||r.fitBounds(t)}function lafka_add_area_label(a,e,o){o&&new google.maps.Marker({position:a,map:e,label:{text:o,fontSize:"12px",className:"lafka-shipping-area-label"},icon:{path:"M 100 100 L 200 200",fillOpacity:0,strokeWeight:0}})}function lafka_get_polygon_label_coordinates(a,e){let o=[],r=[];a.forEach(a=>{o.push(a.lng()),r.push(a.lat())}),r.sort(),o.sort();var t=r[0],a=r[r.length-1],s=o[0],_=t+(a-t)/2,l=s+(o[r.length-1]-s)/2;let n=_,i=l;switch(e){case"top":n=_+(_-t)/2;break;case"right":i=l+(l-s)/2;break;case"bottom":n=_-(_-t)/2;break;case"left":i=l-(l-s)/2}return new google.maps.LatLng(n,i)}async function lafka_handle_radius_for_shortcode(e,a,o,r,t,s,_,l){let n;const i=lafka_convert_radius_to_meters(t,s);return"pick_store_address"===a?(t=JSON.parse(decodeURIComponent(r)),s=new google.maps.LatLng(t.lat,t.lng),n=lafka_draw_radius_for_shortcode(e,s,i,_,l)):"geo_woo_store"===a&&o&&await lafka_geocode_address(o).then(a=>{n=lafka_draw_radius_for_shortcode(e,a.geocoded_destination_address,i,_,l)}),n}async function lafka_geocode_address(a){let e,o;return await(new google.maps.Geocoder).geocode({address:a}).then(({results:a})=>{o=a[0].hasOwnProperty("partial_match")&&a[0].partial_match,e=a[0].geometry.location}).catch(a=>{console.log("Geocode was not successful for the following reason: "+a),o=!0,e=null}),{is_partial_match:o,geocoded_destination_address:e}}function lafka_draw_radius_for_shortcode(a,e,o,r,t){t=new google.maps.Circle({strokeColor:t,strokeOpacity:.8,strokeWeight:3,fillColor:t,fillOpacity:.35,map:a,center:e,radius:o});return lafka_add_area_label(e,a,r),t}function lafka_convert_radius_to_meters(a,e){return"imperial"===e?1609.344*a:1e3*a}window.addEventListener("DOMContentLoaded",function(){lafka_handle_areas_shortcode()});