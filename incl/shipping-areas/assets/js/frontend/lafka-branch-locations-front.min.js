!function(d){"use strict";let f;function u(e){const a=function(e){let a="",o="",t="",n="",l="",c="",s="",r="",_="",i="",d="";if(void 0!==e){void 0!==e.geometry.location&&(d=e.geometry.location);for(const f of e.address_components)switch(f.types[0]){case"street_number":case"premise":o=f.long_name+" "+o;break;case"route":case"sublocality_level_1":case"sublocality_level_2":o+=f.short_name+" ";break;case"postal_code":i=""+f.long_name+i;break;case"postal_code_suffix":i=i+"-"+f.long_name;break;case"locality":t=f.long_name;break;case"administrative_area_level_1":n=f.short_name,l=f.long_name;break;case"administrative_area_level_2":c=f.short_name,s=f.long_name;break;case"administrative_area_level_3":r=f.short_name,_=f.long_name;break;case"country":a=f.short_name}""===o&&(o=e.name)}return{country:a,address_1:o,city:t,state_level_1_short:n,state_level_1_long:l,state_level_2_short:c,state_level_2_long:s,state_level_3_short:r,state_level_3_long:_,postcode:i,geocoded_location:d}}(e);let o="";if("undefined"!=typeof wc_country_select_params){e=wc_country_select_params.countries.replace(/&quot;/g,'"'),e=JSON.parse(e);if(a.country){const n=e[a.country];for(const l in n)if(o="US"===a.country&&l===a.state_level_1_short||"US"!==a.country&&(l===a.state_level_1_short||l===a.country+"-"+a.state_level_1_short||a.state_level_1_long&&n[l].toLowerCase().includes(a.state_level_1_long.toLowerCase())||l===a.state_level_2_short||l===a.country+"-"+a.state_level_2_short||a.state_level_2_long&&n[l].toLowerCase().includes(a.state_level_2_long.toLowerCase())||l===a.state_level_3_short||l===a.country+"-"+a.state_level_3_short||a.state_level_3_long&&n[l].toLowerCase().includes(a.state_level_3_long.toLowerCase()))?l:o)break;!a.city&&a.state_level_1_long&&(a.city=a.state_level_1_long),!a.city&&a.state_level_2_long&&(a.city=a.state_level_2_long),!a.city&&a.state_level_3_long&&(a.city=a.state_level_3_long)}}document.querySelector("#lafka_user_country").value=a.country,document.querySelector("#lafka_user_address_1").value=a.address_1,document.querySelector("#lafka_user_city").value=a.city,document.querySelector("#lafka_user_state").value=o||a.state_level_1_long,document.querySelector("#lafka_user_postcode").value=a.postcode,document.querySelector("#lafka_user_geocoded_location").value=encodeURIComponent(JSON.stringify(a.geocoded_location)),"Santiago"===a.city&&a.state_level_3_long&&(document.querySelector("#lafka_user_city").value=a.city+" "+a.state_level_3_long);const t=d(document.body).find("#lafka_select_branch_form");a.country?(e=m(t,"delivery")).length?b(e):(h(),d(document.body).find(".lafka-branch-selection").hide(),t.find(".lafka-branch-select-message").html(lafka_branch_locations_front.error_message_no_suitable_branches)):d(document.body).find(".lafka-branch-selection").hide()}function h(){document.querySelector("#lafka_user_country").value="",document.querySelector("#lafka_user_address_1").value="",document.querySelector("#lafka_user_city").value="",document.querySelector("#lafka_user_state").value="",document.querySelector("#lafka_user_postcode").value="",document.querySelector("#lafka_user_geocoded_location").value="",d(document.body).find(".lafka-branch-select-image").removeClass("lafka-branch-selected-image"),d(document.body).find("#lafka_selected_branch_id").val(""),d(document.body).find(".lafka-branch-select-message").html("")}function m(e,a){const o=e.find(".lafka-branch-select-message");let t;try{t=JSON.parse(lafka_branch_locations_front.branch_locations_json_data)}catch(e){return o.html(lafka_branch_locations_front.error_message_json_parse),!1}if(!Array.isArray(t))return o.html(lafka_branch_locations_front.error_message_json_parse),!1;var n=e.find("#lafka_user_geocoded_location").val();const l=[];if("delivery"===a)for(const c of t)"delivery_pickup"!==c.order_type&&"delivery"!==c.order_type||!function(e,a,o){var t=o.filter(e=>parseInt(e.id)===parseInt(a));if(0<t.length){t=t[0];if(t.branch_address_geocoded){var e=JSON.parse(decodeURIComponent(e)),n=new google.maps.LatLng(e.lat,e.lng),e=JSON.parse(decodeURIComponent(t.branch_address_geocoded)),e=new google.maps.LatLng(e.lat,e.lng);if(!isNaN(parseInt(t.distance_restriction))){e=google.maps.geometry.spherical.computeDistanceBetween(n,e);if(("imperial"===o.distance_unit?e/1609.344:e/1e3)<parseInt(t.distance_restriction))return 1}if(t.shipping_areas.length)for(const l of t.shipping_areas)if(google.maps.geometry.poly.containsLocation(n,new google.maps.Polygon({paths:google.maps.geometry.encoding.decodePath(l.area_polygon_coordinates)})))return 1}}return}(n,c.id,t)||l.push(c.id);else if("pickup"===a)for(const s of t)"delivery_pickup"!==s.order_type&&"pickup"!==s.order_type||l.push(s.id);return l}function b(e){const a=d(document.body).find(".lafka-branch-select-images"),o=d(document.body).find("#lafka_branch_select");a.find(".lafka-branch-select-image").hide(),o.children().prop("hidden",!0),o.val("");for(const t of e)a.length?(a.find(".lafka-branch-"+t).show(),1===e.length&&a.find(".lafka-branch-"+t+" a").trigger("click")):o.length&&o.children("option[value^='"+t+"']").prop("hidden",!1);d(document.body).find(".lafka-branch-selection").show()}d(document).ready(function(){if(!lafka_branch_locations_front.has_session_value&&"1"!==sessionStorage.getItem("lafka_branch_selection_closed")){const a=d(document.body).find("#lafka_branch_order_type"),o=d(document.body).find(".lafka-branch-delivery"),t=d(document.body).find(".lafka-branch-pickup"),n=d(document.body).find(".lafka-branch-auto-locate"),l=d(document.body).find(".lafka-branch-user-address"),c=d(document.body).find(".lafka-branch-selection"),s=d(document.body).find(".lafka-branch-select-tip"),r=d(document.body).find(".lafka_branch_select_label"),_=d(document.body).find("#lafka_branch_select_user_address"),i=d(document.body).find(".lafka-branch-select-message");(function(){if(null!==(f=document.querySelector("#lafka_branch_select_user_address"))){var t=lafka_branch_locations_front.autocomplete_area.trim().split(","),n=lafka_branch_locations_front.autocomplete_countries;let e=null,a=null,o=(1<t.length&&(e={east:Number(t[0]),north:Number(t[1]),south:Number(t[2]),west:Number(t[3])},a=!0),null);n.length&&n[0].length&&(o={country:n});const l=new google.maps.places.Autocomplete(f,{bounds:e,strictBounds:a,componentRestrictions:o,fields:["address_components","geometry","name","types"]});f.focus(),l.addListener("place_changed",function(){const e=l.getPlace();e.types.includes("street_address")||e.types.includes("establishment")||lafka_branch_locations_front.allow_partial_address&&e.address_components.filter(e=>e.types.includes("route")).length?u(e):d(document.body).find(".lafka-branch-select-message").html(lafka_branch_locations_front.error_message_precise_address)})}})(),o.on("click",function(){h(),i.html(""),t.removeClass("lafka-selected"),o.addClass("lafka-selected"),s.html(lafka_branch_locations_front.info_message_select_branch_delivery),r.html(lafka_branch_locations_front.info_message_select_branch_delivery),a.val("delivery"),c.hide(),l.show()}),t.on("click",function(){h(),i.html(""),o.removeClass("lafka-selected"),t.addClass("lafka-selected"),s.html(lafka_branch_locations_front.info_message_select_branch_pickup),r.html(lafka_branch_locations_front.info_message_select_branch_pickup),a.val("pickup"),l.hide(),b(m(d(document.body).find("#lafka_select_branch_form"),"pickup")),c.show()}),d(document.body).find(".lafka-branch-select-image a").on("click",function(){c.find(".lafka-branch-select-image").removeClass("lafka-branch-selected-image"),d(this).parent(".lafka-branch-select-image").addClass("lafka-branch-selected-image"),d(document.body).find("#lafka_selected_branch_id").val(d(this).data("branchId")),i.html("")}),d(document.body).find("#lafka_branch_select").on("click",function(){i.html("")}),_.on("keypress change",function(e){c.hide(),h(),13===e.keyCode&&e.preventDefault()}),n.on("click",function(){navigator.geolocation.getCurrentPosition(function(e){const a=new google.maps.Geocoder;e={lat:parseFloat(e.coords.latitude),lng:parseFloat(e.coords.longitude)};a.geocode({location:e}).then(e=>{e=e.results.filter(e=>"ROOFTOP"===e.geometry.location_type);e[0]?(_.val(e[0].formatted_address),u(e[0])):i.html(lafka_branch_locations_front.error_message_not_found)}).catch(e=>i.html(lafka_branch_locations_front.error_message_geocoder_failed+": "+e))},function(e){i.html(`ERROR(${e.code}): `+e.message)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),"delivery_pickup"===lafka_branch_locations_front.order_type?(o.show(),t.show(),o.addClass("lafka-selected"),s.html(lafka_branch_locations_front.info_message_select_branch_delivery),r.html(lafka_branch_locations_front.info_message_select_branch_delivery),a.val("delivery"),l.show()):"delivery"===lafka_branch_locations_front.order_type?(o.show(),o.addClass("lafka-selected"),s.html(lafka_branch_locations_front.info_message_select_branch_delivery),r.html(lafka_branch_locations_front.info_message_select_branch_delivery),a.val("delivery"),l.show()):"pickup"===lafka_branch_locations_front.order_type&&(t.show(),t.addClass("lafka-selected"),s.html(lafka_branch_locations_front.info_message_select_branch_pickup),r.html(lafka_branch_locations_front.info_message_select_branch_pickup),a.val("pickup"),c.show());let e=!1;(lafka_branch_locations_front.closable_because_of_closed_branches&&d(document.body).find(".lafka-all-stores-closed").length||lafka_branch_locations_front.closable_because_of_option)&&(e=!0);d.magnificPopup.open({items:{src:"#lafka_select_branch_modal"},modal:!e,focus:"#lafka_branch_select_user_address",callbacks:{close:function(){sessionStorage.setItem("lafka_branch_selection_closed","1")}}})}d(document.body).on("click","a.lafka-branch-select-submit",function(){sessionStorage.removeItem("lafka_branch_selection_closed");const a=d(document.body).find("#lafka_select_branch_modal"),o=d(this).closest("form");if(!function(e){const a=e.find("#lafka_branch_order_type"),o=e.find("#lafka_branch_select"),t=e.find("#lafka_selected_branch_id"),n=e.find("#lafka_branch_select_user_address"),l=e.find("#lafka_user_country"),c=e.find(".lafka-branch-select-message");let s="";o.val()?s=o.val():t.val()&&(s=t.val());return c.html(""),"delivery"!==a.val()||n.val()&&l.val()?!!s||(c.html(lafka_branch_locations_front.error_message_select_branch),!1):(c.html(lafka_branch_locations_front.error_message_no_address),!1)}(o))return!1;var e={_ajax_nonce:o.find("#_wpnonce").val(),action:"lafka_select_branch",dataType:"json",fields:encodeURIComponent(o.find("input, select").serialize())};a.block({message:"<p>"+lafka_branch_locations_front.please_wait_message+"...</p>",css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),d.post(lafka_branch_locations_front.ajax_url,e,function(e){e.success?location.reload():(e.data[0].message,o.find(".lafka-branch-select-message").html(e.data[0].message),a.unblock())})}),d(document.body).on("click",".lafka-change-branch a",function(){sessionStorage.removeItem("lafka_branch_selection_closed");var e={_ajax_nonce:d(this).data("nonce"),action:"lafka_change_branch",dataType:"json"};d.post(lafka_branch_locations_front.ajax_url,e,function(e){e.success&&location.reload()})}),d(document.body).trigger("updated_wc_div")}),d(window).load(function(){if(-1<navigator.userAgent.toLowerCase().indexOf("firefox")){const e=d(document).find("form.woocommerce-checkout");e.length&&e[0].reset()}})}(window.jQuery);