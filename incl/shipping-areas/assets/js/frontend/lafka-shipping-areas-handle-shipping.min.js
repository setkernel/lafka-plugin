!function(_){"use strict";_(document).ajaxStart(function(e){var o;o={message:null,overlayCSS:{background:"#fff",opacity:.6}},_(document.body).find("#lafka_pick_delivery_address_field").block(o),_(document.body).find(".lafka-change-branch").block(o)}),_(document).ajaxComplete(function(){_(document.body).find("#lafka_pick_delivery_address_field").unblock(),_(document.body).find(".lafka-change-branch").unblock()});let n;function e(){_(document.body).find("#lafka_picked_delivery_geocoded").val(""),_("#lafka_is_location_clicked").val("")}function a(e){_(document.body).find("h3.lafka-address-marked").hide(),_(document.body).find("h3.lafka-address-not-found").show();const n=_(document.body).find("#shipping_method");var o=n.find("li").find('input[value*="lafka_shipping_areas_method"]'),a=_(document.body).find("#lafka-pick-delivery-address-checkout-map");const t=_(document.body).find("#lafka_picked_delivery_geocoded");let d="",i="";if(t.val()&&"undefined"!==t.val()?(s=JSON.parse(t.val()),d=new google.maps.LatLng(s.lat,s.lng),t.val("")):i=void 0!==e.fragments.delivery_address?function(e){let o="";{var a;void 0!==e.state&&e.state&&("undefined"!=typeof wc_country_select_params?(a=wc_country_select_params.countries.replace(/&quot;/g,'"'),a=JSON.parse(a),e.country in a&&(o=a[e.country][e.state])):o=e.state)}return(e.address_1+" "+e.address_2+" "+e.postcode+" "+e.city+" "+o+" "+e.country).trim()}(e.fragments.delivery_address):"",void 0!==e.fragments.delivery_address){var s=e.fragments.delivery_address;const r=_(document).find(".lafka-change-branch-full-address");if(r.length){let e="";void 0!==s.state&&("undefined"!=typeof wc_country_select_params?(c=wc_country_select_params.countries.replace(/&quot;/g,'"'),c=JSON.parse(c),s.country in c&&(e=c[s.country][s.state])):e=s.state);const l=[];s.address_1&&l.push(s.address_1),s.address_2&&l.push(s.address_2),s.postcode&&l.push(s.postcode),s.city&&l.push(s.city),e&&l.push(e),s.country_label&&l.push(s.country_label);var c=l.join(", ");r.html(c)}}!async function(e,o,a,t,d){let n,i=!1,s=[];t?n=t:a&&({is_partial_match:i,geocoded_address:n}=await u(a));e.length?(o.find(".lafka-shipping-no-options").remove(),_(document.body).find("#place_order").prop("disabled",!1).removeClass("lafka-disabled"),s=await async function(e,o,a,t,d,n){e.find("li").each(function(){_(this).css("opacity","0.75"),_(this).show()});const i=[];for(const l of o){const p=_(l);var s=p.closest("li"),c=p.val().substring(p.val().indexOf(":")+1),r=lafka_shipping_properties["shipping_area_instance_"+c],r=(void 0!==r&&a&&!function(e,o){return google.maps.geometry.poly.containsLocation(e,new google.maps.Polygon({paths:google.maps.geometry.encoding.decodePath(o)}))}(a,r.shipping_area_coordinates)&&i.push(s),lafka_shipping_properties["radius_area_instance_"+c]);void 0!==r&&a&&(r.branch_location_address_geocoded?(c=JSON.parse(decodeURIComponent(r.branch_location_address_geocoded)),c=new google.maps.LatLng(c.lat,c.lng),m(a,c,r.max_radius,r.shipping_method_distance_unit)||i.push(s)):"geo_woo_store"===lafka_set_store_location&&t?(c=(await u(t)).geocoded_address,m(a,c,r.max_radius,r.shipping_method_distance_unit)||i.push(s)):"pick_store_address"===lafka_set_store_location&&lafka_store_map_location&&(c=JSON.parse(decodeURIComponent(lafka_store_map_location)),c=new google.maps.LatLng(c.lat,c.lng),m(a,c,r.max_radius,r.shipping_method_distance_unit)||i.push(s)))}d.length&&f(a,n);return i}(o,e,n,lafka_store_address,d,i)):d.length&&f(n,i);return s}(o,n,i,d,a).then(e=>{a=n,i=e,a.find("li").each(function(){if(!p(_(this),i)){const n=_(this).find("input");var a=n.val().substring(n.val().indexOf(":")+1),t=lafka_shipping_properties["shipping_area_instance_"+a],d=lafka_shipping_properties["radius_area_instance_"+a];let e=0,o=0;void 0!==t?(e=parseFloat(t.min_amount),o=parseFloat(t.cart_subtotal)):void 0!==d&&(e=parseFloat(d.min_amount),o=parseFloat(d.cart_subtotal)),e&&o&&o<e&&(_(document).find(`[data-lafka-method-id='${a}']`).show(),i.push(_(this)))}}),e=i;var i,a=function(e,a){if(lafka_lowest_cost_shipping){let o=Number.MAX_SAFE_INTEGER;e.find("li").each(function(){if(!p(_(this),a)){const e=_(this).find("input.lafka-shipping-cost");e.length&&e.val()<o&&(o=e.val())}}),e.find("li").each(function(){const e=_(this).find("input.lafka-shipping-cost");!e.hasClass("local_pickup")&&e.val()>o&&a.push(_(this))})}return a}(n,e);{e=a,a=n;let o=!1;const t=_(document.body).find(".cart-subtotal .amount"),d=_(document.body).find(".order-total .amount");return d.siblings(".lafka-copied-total").remove(),d.removeClass("hidden"),e.forEach(e=>{!1===o&&(o=_(e).find("input.shipping_method").is(":checked")),_(e).hide()}),void(a.find("li:visible").length?o&&a.find("li input.shipping_method:visible").first().prop("checked",!0).trigger("change"):a.length&&(a.append('<li class="lafka-shipping-no-options"><span>'+lafka_no_shipping_methods_string+"</span></li>"),d.addClass("hidden"),d.parent().append(t.clone().addClass("lafka-copied-total")),_(document.body).find("#place_order").prop("disabled",!0)))}})}function p(e,o){if(void 0!==o){const a=e.find("input.shipping_method").attr("id");return void 0!==o.find(e=>_(e).find("input.shipping_method").attr("id")===a)}}function f(e,o){if("when_fail"===lafka_checkout_map_properties.pick_delivery_address_option&&!o)return document.getElementById("lafka_picked_delivery_geocoded").value="",void _(document.body).find("#lafka_pick_delivery_address_field").addClass("hidden");let a,t;t=null===e?(a=new google.maps.LatLng("50.8550625","4.3053505"),1):(a=e,15);const d=new google.maps.Map(document.getElementById("lafka-pick-delivery-address-checkout-map"),{center:a,zoom:t});_(document.body).find("#lafka_pick_delivery_address_field").removeClass("hidden"),o?d.setZoom(12):(n=new google.maps.Marker({position:e,map:d}),i(d,e)),d.addListener("click",e=>{i(d,e.latLng),_("#lafka_is_location_clicked").val("clicked"),_(document.body).trigger("update_checkout")})}async function u(t){let d=null,n=!0;return await(new google.maps.Geocoder).geocode({address:t}).then(({results:e})=>{var o,a;o=t,a=e,lafka_debug_mode&&_(".woocommerce-notices-wrapper:first-child").html('<div class="woocommerce-message lafka-geocode-debug-info"><h3>Google Maps Geocode api call info:</h3><h4>Request:</h4>Address string: '+o+"<h4>Geocode Response:</h4><br>"+JSON.stringify(a)+"</div>"),n=e[0].hasOwnProperty("geometry")&&"APPROXIMATE"===e[0].geometry.location_type,d=e[0].geometry.location}).catch(e=>{console.log("Geocode was not successful for the following reason: "+e)}),{is_partial_match:n,geocoded_address:d}}function m(e,o,a,t){e=google.maps.geometry.spherical.computeDistanceBetween(e,o);return("imperial"===t?e/1609.344:e/1e3)<a}function i(e,o){n&&n.setMap(null),n=new google.maps.Marker({position:o,map:e}),document.getElementById("lafka_picked_delivery_geocoded").value=JSON.stringify(o),_(document.body).find("h3.lafka-address-not-found").hide(),_(document.body).find("h3.lafka-address-marked").show()}_(document.body).on("updated_checkout",function(e,o){"pickup"!==lafka_order_type&&(_(document.body).find("tr.woocommerce-shipping-totals").css("opacity",0),_(document.body).find("tr.order-total").css("opacity",0),_(document.body).find("h3.lafka-address-not-found").css("opacity",0),_(document.body).find("h3.lafka-address-marked").css("opacity",0),a(o),setTimeout(()=>{_(document.body).find("tr.woocommerce-shipping-totals").css("opacity",1),_(document.body).find("tr.order-total").css("opacity",1),_(document.body).find("h3.lafka-address-not-found").css("opacity",1),_(document.body).find("h3.lafka-address-marked").css("opacity",1)},1e3)),_(document.body).find("tr.order-total").css("opacity",1)}),_(document).ready(function(){_(document.body).find("form.checkout .address-field input").on("keydown",e),_(document.body).find("form.checkout .address-field select").on("change",e),_(".cart_totals").length&&"undefined"!=typeof lafka_shipping_destination_address_property&&a({fragments:{delivery_address:lafka_shipping_destination_address_property}})})}(window.jQuery);